# schedulebot
С помощью данного бота можно получить расписание занятий, указав группу, а также включить уведомления о предстоящих занятиях. Пользователи могут получать актуальную информацию о расписании, а также управлять своими группами через удобный интерфейс бота.
Для получения расписания приложение отправляет запросы к сайту ИТМО, обрабатывает их и формирует файлы с расписанием. В дальнейшем бот обращается к этим файлам, чтобы сформировать сообщение пользователю. 
Бот имеет панель администратора, позволяющую добавлять, удалять и обновлять расписание для групп. Реализация бота основана на использовании библиотеки aiogram для взаимодействия с API Telegram, а также интеграции с базой данных для хранения информации о пользователях и других данных.

Работа выполнена в рамках ВКР.

[Демонстрация работы](https://www.youtube.com/watch?v=TRZI-ajt9u0&ab_channel=AleksandrSbitnev)

# Руководство
## Требования
Для запуска бота требуется устройство с доступом в интернет, так как бот должен быть постоянно онлайн для обработки запросов пользователей. Также необходимо наличие устройства с поддержкой языка программирования Python для запуска скриптов бота. В зависимости от нагрузки и ожидаемого числа пользователей, может потребоваться выделенный сервер или облачный хостинг для обеспечения стабильной работы бота.
В данном руководстве будет использована Ubuntu 22.04 LTS.
Минимальные системные требования:
* ​vCPU: 2
* RAM: 2 ГБ
* Объём дискового пространства: 10 ГБ
## Подготовка среды
Для начала потребуется загрузить репозиторий с ботом, для этого стоит обратиться к репозиторию GitHub проекта, достпному по ссылке: https://github.com/Sbitnev/schedulebot. 
Используя команду “git clone https://github.com/Sbitnev/schedulebot” клонируем репозиторий на устройство.
Для работы приложения потребуется Python, на ОС Ubuntu он предустановлен. Также для корректной работы с базой данных потребуется SQLite, устанавливаем его с помощью команды: “sudo apt-get install sqlite3”.
Установим необходимые библиотеки, их список хранится в файле requirements.txt. Для этого нужно установить pip, используем команду: “sudo apt -y install python3-pip”, находясь в репозитории проекта. 
Теперь можем установить библиотеки командой “pip install -r requirements.txt”.
## Развертывание 
Теперь в файле createbot.py нужно указать токен бота и id чата администратора. Токен можно получить при регистрации бота в BotFather, как это показано на рисунке.

![Получение токена](https://github.com/Sbitnev/schedulebot/assets/71010852/305e955b-59cf-487b-9cea-3bc43a07bc14)

Id чата можно узнать несколькими способами, разберем самый простой. Для этого добавим стороннего бота @LeadConverterToolkitBot в наш чат, теперь напишем команду /get_chat_id. В ответ получим id чата, как это показано на рисунке, теперь можно выгнать этого бота из чата и добавить нашего.

![Получение id чата](https://github.com/Sbitnev/schedulebot/assets/71010852/d81b6b21-3ae0-44f5-b8da-43e821a86514)

Теперь можно запустить бота, воспользовавшись командой: “python3 main.py”. В ответ получим сообщение как на рисунке 14, значит бот работает.

![Запуск бота](https://github.com/Sbitnev/schedulebot/assets/71010852/760793d1-4dfa-41b5-be17-e366e4cad54b)

## Администрирование
Для администрирования нужно использовать чат администрации, только там будут работать команды для внесения изменений в хранилище и базу данных.
Панель администратора вызывается с помощью команды /admin. В её функционал входит:
Добавление расписания для группы. Для этого требуется нажать “Добавить группу” в панели администратора, после чего указать номер группы, для которой требуется загрузить расписание. В результате в хранилище сервера появится файл с расписанием для требуемой группы, а в базе данных появится ссылка на него в соответствующей ячейке.
Удаление расписания для группы. Для этого в панели администратора требуется нажать “Удалить группу” и, если расписание было на сервере, оно удалится с хранилища, а в базе данных удаляется ссылка.
Обновление расписания для группы. Для этого требуется нажать “Обновить группу” в панели администратора и указать номер группы, после чего инициализируется удаление и повторная загрузка расписания.
Для того чтобы посмотреть запросы на загрузку расписания, требуется нажать “Все запросы”, после чего появится список всех групп, для которых поступал запрос и панель с выбором действий. Для загрузки всех расписаний требуется нажать “Добавить все”, чтобы вернуться в меню требуется нажать “Меню ”.
Также есть возможность дать пользователям загружать расписание без подтверждения администратора, для этого требуется нажать “Разрешить парсинг” в панели администратора, для того чтобы запретить загружать расписание без подтверждения администратора, требуется нажать  “Запретить парсинг” в панели администратора.
Чтобы указать период обучения, требуется нажать “Изменить время обучения” и указать дату начала и конца обучения. Чтобы узнать действительные значения, требуется нажать “Узнать время обучения”, после чего выводится дата начала и конца обучения.
